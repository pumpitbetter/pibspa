# Development Environment Setup

This guide walks you through setting up your development environment for PumpItBetter on macOS, including all certificates, keys, and files needed for automated builds.

## üèóÔ∏è Project Architecture Overview

PumpItBetter uses a **dual-build architecture** that creates different outputs from a single codebase:

### üì± SPA Build ‚Üí Mobile Apps
- **Purpose:** iOS, Android, and Desktop applications
- **Technology:** React Router in SPA mode + Tauri
- **Output:** `build/spa/` directory consumed by Tauri
- **Features:** Native performance, offline-first, cross-platform sync

### üåê SSR Build ‚Üí Marketing Website
- **Purpose:** SEO-optimized marketing website with database integration
- **Technology:** React Router in SSR mode with server functions
- **Output:** `build/ssr/` directory ready for web hosting
- **Features:** Server-side rendering, `loader()`/`action()` functions, database connectivity

### üîÑ Development Benefits
- **Shared Components:** Same UI library across all platforms
- **Unified Workflow:** Single development environment for all targets
- **Consistent Design:** Same styling system (TailwindCSS) everywhere
- **Code Efficiency:** Write once, deploy to multiple platforms

## üìã Prerequisites

- **macOS**: This guide is specifically for macOS users
- **Apple Developer Account**: Required for iOS development and deployment
- **Google Play Console Account**: Required for Android deployment ($25 one-time fee)
- **Homebrew**: macOS package manager (we'll install this first)

## üîê Required Files and Certificates Overview

Before starting development, you'll need these files for automated builds:

### iOS Build Requirements
- **Apple Distribution Certificate** - In macOS Keychain
- **App Store Provisioning Profile** - `com.pumpitbetter.app AppStore`
- **Apple Developer Credentials** - In `.env` file

### Android Build Requirements  
- **Android Keystore File** - `keystore.jks` (2,820 bytes)
- **Google Play Service Account JSON** - `pumpitbetter-05d1d8b55bc8.json` (2,374 bytes)
- **Android Signing Credentials** - In `.env` file

### Environment Configuration File
- **`.env` file** - Contains all credentials (NOT committed to git)

## üîë Required Certificates and Keys

### iOS Certificates and Profiles

| Item | Type | Name/Identifier | Location | Auto-Generated |
|------|------|----------------|----------|---------------|
| **Apple Distribution Certificate** | Certificate | `Apple Distribution: [Developer Name] ([TEAM_ID])` | macOS Keychain | ‚úÖ By FastLane |
| **App Store Provisioning Profile** | Profile | `com.pumpitbetter.app AppStore` | `~/Library/MobileDevice/Provisioning Profiles/` | ‚úÖ By FastLane |
| **App Identifier** | Bundle ID | `com.pumpitbetter.app` | Apple Developer Portal | ‚ùå Manual setup |

### Android Signing Files

| Item | Type | Filename | Size | Purpose |
|------|------|----------|------|---------|
| **Android Keystore** | JKS File | `keystore.jks` | 2,820 bytes | App signing |
| **Google Play Service Account** | JSON File | `pumpitbetter-05d1d8b55bc8.json` | 2,374 bytes | Play Store API access |

### Required Keystore Details
- **Keystore Format**: JKS (Java KeyStore)
- **Key Algorithm**: RSA 2048-bit
- **Key Alias**: `pumpitbetter`
- **Validity**: 10,000 days
- **Certificate**: Self-signed for app signing

## üìÅ Critical Files for New Build Machine

When setting up a new build machine, you need these files:

### 1. Environment Configuration
```bash
# Required: .env file (copy from secure location)
.env                           # Contains all secrets - NEVER commit
```

### 2. iOS Files (Auto-generated by FastLane)
```bash
# These are automatically created during first build:
~/Library/MobileDevice/Provisioning\ Profiles/   # Provisioning profiles
# macOS Keychain will contain Apple Distribution certificate
```

### 3. Android Files (Required - Copy from secure backup)
```bash
keystore.jks                   # Android app signing keystore (2,820 bytes)
pumpitbetter-05d1d8b55bc8.json # Google Play Console service account key (2,374 bytes)
```

### 4. File Backup Strategy

**For Team Sharing/New Machines:**

```bash
# Files to backup securely (NOT in git):
.env                           # All credentials
keystore.jks                   # Android signing keystore  
pumpitbetter-05d1d8b55bc8.json # Google Play API key

# Optional backup (can be regenerated):
~/ios-certificates-backup/     # iOS certificates export
```

**Recommended Secure Storage:**
- 1Password shared vault
- Encrypted USB drive
- Secure team cloud storage (encrypted)
- Company password manager

## üõ†Ô∏è Core Development Tools

**‚ö° Most tools are automatically installed when you run `npm install`!**

The following tools will be automatically set up during `npm install`:

### 1. Install Homebrew

**Automatic Installation:** ‚úÖ Installed automatically if missing

```bash
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```

### 2. Install Node.js and npm

**Manual Installation Required:**
```bash
brew install node
```

Verify installation:
```bash
node --version  # Should be 18+ or higher
npm --version
```

### 3. Install Git (if not already installed)

**Manual Installation Required:**
```bash
brew install git
```

### 4. Install fswatch (for file watching and hot reloading)

**Automatic Installation:** ‚úÖ Installed automatically

**Manual Installation:**
```bash
brew install fswatch
```

Verify installation:
```bash
fswatch --version
```

**Purpose:** `fswatch` enables automatic file synchronization during SSR development. When you edit files in `app/routes-ssr/`, they are automatically copied to the active `app/routes/` directory for hot reloading.

### 5. Install Ruby with rbenv (Required for Fastlane)

**Automatic Installation:** ‚úÖ rbenv installed automatically, Ruby setup may require manual steps

**Manual Installation:**
```bash
# Install rbenv and ruby-build
brew install rbenv ruby-build

# Add rbenv to your shell
echo 'export PATH="$HOME/.rbenv/bin:$PATH"' >> ~/.zshrc
echo 'eval "$(rbenv init -)"' >> ~/.zshrc
source ~/.zshrc

# Install latest stable Ruby
rbenv install 3.4.5
rbenv global 3.4.5 && rbenv rehash
```

### 6. Install Fastlane

**Automatic Installation:** ‚úÖ Installed automatically if Ruby is available

**Manual Installation:**
```bash
gem install fastlane
```

### 7. Install Rust Toolchain

**Automatic Installation:** ‚úÖ Installed automatically with iOS targets

**Manual Installation:**
```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source ~/.cargo/env

# Add iOS targets
rustup target add aarch64-apple-ios x86_64-apple-ios aarch64-apple-ios-sim
```

### 8. Install Fly.io CLI (for web deployment)

**Automatic Installation:** ‚úÖ Installed automatically

**Manual Installation:**
```bash
brew install flyctl
```

Verify installation:
```bash
flyctl --version
```

**Purpose:** `flyctl` enables deployment of both the SSR marketing website and SPA fitness app to Fly.io cloud platform. The dual-app deployment serves:
- `www.pumpitbetter.com` ‚Üí SSR marketing site
- `app.pumpitbetter.com` ‚Üí SPA fitness app

Both applications run on the same Fly.io instance with subdomain-based routing.

**Manual Installation Required:** ‚ö†Ô∏è Cannot be automated

1. **Install Xcode from App Store**
   - Search for "Xcode" in App Store
   - Download and install (this is large, ~10GB)

2. **Install Xcode Command Line Tools**
   ```bash
   xcode-select --install
   ```

3. **Accept Xcode License**
   ```bash
   sudo xcodebuild -license accept
   ```

## ü¶Ä Rust Development Environment

**Automatic Installation:** ‚úÖ Handled by `npm install`

The postinstall script automatically:
- Installs Rust toolchain
- Adds iOS targets for mobile development
- Sets up cargo environment

**Manual verification:**
```bash
rustc --version
cargo --version
```

## üì± iOS Development Setup

### 1. Install Ruby with rbenv (Required for Fastlane)

**Why rbenv?** Fastlane recommends using a Ruby version manager instead of system Ruby.

```bash
# Install rbenv and ruby-build
brew install rbenv ruby-build

# Add rbenv to your shell
echo 'export PATH="$HOME/.rbenv/bin:$PATH"' >> ~/.zshrc
echo 'eval "$(rbenv init -)"' >> ~/.zshrc
source ~/.zshrc

# Check available Ruby versions (install the latest)
rbenv install --list | grep -E '^[0-9]+\.[0-9]+\.[0-9]+$' | tail -5

# Install latest stable Ruby (currently 3.4.5)
rbenv install 3.4.5

# Set as global default
rbenv global 3.4.5 && rbenv rehash

# Verify installation
ruby --version && gem --version
```

### 2. Install Fastlane and Dependencies

```bash
# Install Fastlane
gem install fastlane

# Install dotenv gem for automatic .env loading
gem install dotenv
```

Verify installation:
```bash
fastlane --version
gem list dotenv
```

### 3. Apple Developer Account Setup

#### Required Apple Developer Resources

For iOS development and deployment, you need:

1. **Apple Developer Account** ($99/year)
   - Individual or Organization account
   - Enrolled and active

2. **App Identifier (Bundle ID)**
   - Registered in Apple Developer Portal
   - Format: `com.pumpitbetter.app`

3. **Apple Distribution Certificate**
   - For App Store distribution
   - Generated in Apple Developer Portal

4. **App Store Provisioning Profile**
   - Links your app ID and distribution certificate
   - Enables App Store distribution

#### Setting Up Certificates and Provisioning Profiles

**Option 1: Automatic Management (Recommended)**

FastLane can automatically create and manage certificates for you:

```bash
# Initialize FastLane for your project
cd fastlane
fastlane cert  # Creates distribution certificate if needed
fastlane sigh  # Creates provisioning profile if needed
```

This will:
- Create an Apple Distribution certificate in your Keychain
- Generate an App Store provisioning profile
- Download and install both automatically

**Option 2: Manual Setup via Apple Developer Portal**

1. **Create App Identifier:**
   - Go to [developer.apple.com](https://developer.apple.com) ‚Üí **Certificates, Identifiers & Profiles**
   - Click **Identifiers** ‚Üí **+** (Add)
   - Select **App IDs** ‚Üí **App**
   - Bundle ID: `com.pumpitbetter.app`
   - Description: "Pump It Better"
   - Capabilities: Enable as needed

2. **Create Apple Distribution Certificate:**
   - Go to **Certificates** ‚Üí **+** (Add)
   - Select **Apple Distribution** (for App Store)
   - Follow prompts to generate Certificate Signing Request (CSR)
   - Download and install certificate in Keychain

3. **Create App Store Provisioning Profile:**
   - Go to **Profiles** ‚Üí **+** (Add)
   - Select **App Store** distribution
   - Choose your App ID (`com.pumpitbetter.app`)
   - Select your Apple Distribution certificate
   - Name: "com.pumpitbetter.app AppStore"
   - Download and install profile

#### Certificate and Profile Verification

**Check installed certificates:**
```bash
# List all code signing certificates
security find-identity -v -p codesigning

# Should show something like:
# 1) ABC123DEF456GHI789JKL012MNO345PQR678STU9 "Apple Distribution: Your Name (TEAM_ID)"
```

**Check provisioning profiles:**
```bash
# List installed provisioning profiles
ls ~/Library/MobileDevice/Provisioning\ Profiles/

# Check profile details
fastlane sigh --readonly
```

**Verify FastLane can access your setup:**
```bash
cd fastlane
fastlane cert --readonly  # Shows your certificates
fastlane sigh --readonly  # Shows your provisioning profiles
```

#### Troubleshooting Certificate Issues

**"No valid code signing identity found"**
```bash
# Check if certificate is in keychain
security find-identity -v -p codesigning

# If missing, regenerate certificate
fastlane cert --force
```

**"Provisioning profile not found"**
```bash
# Regenerate provisioning profile
fastlane sigh --force

# Or create new one with specific name
fastlane sigh --force --app_identifier com.pumpitbetter.app --provisioning_name "com.pumpitbetter.app AppStore"
```

**"Certificate is not valid"**
- Check certificate expiration in Keychain Access
- Regenerate if expired: `fastlane cert --force`
- Ensure certificate is for correct Team ID

## üîê Certificate Management & Team Sharing

### Backing Up Certificates

**Export certificates for team sharing:**
```bash
# Export certificate and private key from Keychain
# 1. Open Keychain Access
# 2. Find "Apple Distribution: Your Name (TEAM_ID)"
# 3. Right-click ‚Üí Export ‚Üí Save as .p12 file
# 4. Set a password for the .p12 file

# Or use command line:
security find-certificate -c "Apple Distribution" -p > apple_distribution.cer
```

**Create certificate backup script:**
```bash
#!/bin/bash
# backup-certificates.sh

# Create backup directory
mkdir -p ~/ios-certificates-backup

# Export distribution certificate
security find-certificate -c "Apple Distribution" -p > ~/ios-certificates-backup/apple_distribution.cer

# Copy provisioning profiles
cp ~/Library/MobileDevice/Provisioning\ Profiles/* ~/ios-certificates-backup/

echo "Certificates backed up to ~/ios-certificates-backup/"
```

### Restoring Certificates on New Machine

**For new team members or new development machine:**

1. **Get certificate files from team:**
   - Apple Distribution certificate (.cer or .p12)
   - App Store provisioning profile (.mobileprovision)

2. **Install certificate:**
   ```bash
   # Double-click .cer file to install in Keychain
   # OR import .p12 file with password
   
   # Verify installation
   security find-identity -v -p codesigning
   ```

3. **Install provisioning profile:**
   ```bash
   # Double-click .mobileprovision file
   # OR copy to profiles directory
   cp profile.mobileprovision ~/Library/MobileDevice/Provisioning\ Profiles/
   ```

4. **Test setup:**
   ```bash
   cd fastlane
   fastlane cert --readonly
   fastlane sigh --readonly
   ```

### Certificate Management Options

**Current Setup (Recommended)**: This project uses automatic certificate management via FastLane `cert` and `sigh` actions:

```bash
cd fastlane

# Check certificate status  
fastlane cert --readonly

# Check provisioning profile status
fastlane sigh --readonly --app_identifier com.pumpitbetter.app
```

**Benefits of Current Approach:**
- Simple setup and maintenance
- Automatic certificate/profile creation when needed
- Works seamlessly with single developer or small teams
- No additional repository setup required
- Certificates stored locally and managed automatically

**Alternative: FastLane Match (For Large Teams)**

If you have a large team and need centralized certificate management, FastLane Match can be considered:

```bash
# Would require additional setup (not currently implemented)
fastlane match init
fastlane match appstore
```

**Note**: This project currently uses the simpler `cert`/`sigh` approach which works perfectly for the current team size.

### 4. iOS Simulator (Optional for Development)

Open Xcode and go to:
- **Xcode** ‚Üí **Settings** ‚Üí **Platforms**
- Download iOS simulators you want to test on

## ‚ö° Tauri Setup

### Install Tauri CLI

```bash
npm install -g @tauri-apps/cli
```

Verify installation:
```bash
npx tauri --version
```

## ü§ñ Android Development Setup

### 1. Install Android SDK and Android Studio

```bash
# Install Android Studio
brew install --cask android-studio

# Start Android Studio and complete the setup wizard
# This will install the Android SDK, platform tools, and emulator
```

### 2. Set up Android Environment Variables

Add these to your `~/.zshrc` file:

```bash
# Add Android SDK environment variables
echo 'export ANDROID_HOME=$HOME/Library/Android/sdk' >> ~/.zshrc
echo 'export PATH=$PATH:$ANDROID_HOME/emulator' >> ~/.zshrc
echo 'export PATH=$PATH:$ANDROID_HOME/platform-tools' >> ~/.zshrc
echo 'export PATH=$PATH:$ANDROID_HOME/cmdline-tools/latest/bin' >> ~/.zshrc
source ~/.zshrc
```

### 3. Android Keystore (for signing)

**If you have existing keystore file (`keystore.jks`):**
```bash
# Copy keystore file to project root
cp /path/to/secure/backup/keystore.jks ./keystore.jks

# Verify keystore
keytool -list -v -keystore ./keystore.jks -alias pumpitbetter
```

**If creating new keystore:**
```bash
# Generate a new keystore file (for app signing)
keytool -genkey -v -keystore ./keystore.jks -alias pumpitbetter -keyalg RSA -keysize 2048 -validity 10000

# This will prompt for:
# - Keystore password (remember this!)
# - Key alias password (can be same as keystore password)
# - Name, organization, etc. information
```

**Keystore Requirements:**
- **Format**: JKS (Java KeyStore)
- **Key Algorithm**: RSA 2048-bit  
- **Key Alias**: `pumpitbetter`
- **Validity**: 10,000 days
- **Size**: ~2,820 bytes when created

### 4. Verify Android Setup

```bash
# Check that Android SDK is properly installed
adb --version

# Check that Android Studio is installed
ls -la /Applications/Android\ Studio.app
```

### 5. Set up Play Store Deployment (Optional)

For Google Play Store deployment:

1. **Create a Google Play Console Account**
   - Visit [play.google.com/console](https://play.google.com/console)
   - Register as a developer ($25 one-time fee)
   
2. **Create Service Account for API Access**
   - Go to Google Play Console ‚Üí **Setup** ‚Üí **API access**
   - Create a new service account
   - Download JSON key file
   - Save as `play-store-key.json` in project root
   
3. **Update .env file with Android credentials**
   ```properties
   # Android credentials (already added to .env.example)
   ANDROID_KEYSTORE_PATH="./keystore.jks"
   ANDROID_KEYSTORE_PASSWORD="your_keystore_password"
   ANDROID_KEY_ALIAS="pumpitbetter"
   ANDROID_KEY_PASSWORD="your_key_password" 
   PLAY_STORE_JSON_KEY_PATH="./pumpitbetter-05d1d8b55bc8.json"
   GOOGLE_PLAY_PACKAGE_NAME="com.pumpitbetter.app"
   ```

## ÔøΩ Setting Up New Build Machine

### Quick Setup Checklist

When setting up automated builds on a new laptop:

#### 1. Install Development Environment
- ‚úÖ Follow all installation steps above (Homebrew ‚Üí Node.js ‚Üí Xcode ‚Üí Rust ‚Üí Ruby/FastLane ‚Üí Android Studio)
- ‚úÖ Clone project: `git clone [repository-url] && cd pibspa && npm install`

#### 2. Copy Required Files to Project Root
```bash
# Copy these files from secure backup to project root:
cp /secure/backup/.env ./                                    # All credentials
cp /secure/backup/keystore.jks ./                           # Android keystore (2,820 bytes)
cp /secure/backup/pumpitbetter-05d1d8b55bc8.json ./         # Google Play API key (2,374 bytes)
```

#### 3. Verify File Permissions and Contents
```bash
# Check files exist and have correct sizes
ls -la .env keystore.jks pumpitbetter-05d1d8b55bc8.json

# Expected output:
# -rw-------  1 user  staff   XXX bytes .env
# -rw-r--r--  1 user  staff  2820 bytes keystore.jks  
# -rw-r--r--  1 user  staff  2374 bytes pumpitbetter-05d1d8b55bc8.json

# Verify keystore contents
keytool -list -v -keystore ./keystore.jks -alias pumpitbetter
# Should show: Certificate fingerprint (SHA256) and validity dates

# Verify Google Play JSON structure  
cat pumpitbetter-05d1d8b55bc8.json | jq '.type'
# Should output: "service_account"
```

#### 4. Test Automated Build Pipeline
```bash
# Test iOS automation (will auto-create certificates if needed)
npm run ios:beta

# Test Android automation  
npm run android:beta

# Both should complete successfully with:
# ‚úÖ Build ‚Üí Sign ‚Üí Upload ‚Üí "üéâ Complete!"
```

### Credential Requirements in .env File

Your `.env` file must contain these exact variables:

```properties
# Apple Developer credentials
APPLE_ID="[apple-developer-email@example.com]"
APP_SPECIFIC_PASSWORD="[abcd-efgh-ijkl-mnop]"  
TEAM_ID="[10-character-team-id]"
BUNDLE_ID="com.pumpitbetter.app"
APP_NAME="Pump It Better"

# Android credentials  
ANDROID_KEYSTORE_PATH="./keystore.jks"
ANDROID_KEYSTORE_PASSWORD="[keystore-password]"
ANDROID_KEY_ALIAS="pumpitbetter"
ANDROID_KEY_PASSWORD="[key-password]"
PLAY_STORE_JSON_KEY_PATH="./pumpitbetter-05d1d8b55bc8.json"
GOOGLE_PLAY_PACKAGE_NAME="com.pumpitbetter.app"
```

### Generating Missing Credentials

**If you need to regenerate Apple App-Specific Password:**
1. Go to [appleid.apple.com](https://appleid.apple.com) ‚Üí Security ‚Üí App-Specific Passwords
2. Generate new password labeled "FastLane PumpItBetter [New Machine]"
3. Update `.env` file with new password

**If you need to find Apple Team ID:**
1. Go to [developer.apple.com](https://developer.apple.com) ‚Üí Account ‚Üí Membership Details
2. Copy 10-character Team ID (format: `ABC123DEF4`)
3. Update `.env` file with Team ID

**If keystore is lost (Android):**
```bash
# Generate new keystore (will require new app version in Play Store)
keytool -genkey -v -keystore ./keystore.jks -alias pumpitbetter -keyalg RSA -keysize 2048 -validity 10000

# Update .env with new keystore passwords
```

**If Google Play JSON key is lost:**
1. Go to [Google Play Console](https://play.google.com/console) ‚Üí Setup ‚Üí API access  
2. Create new service account or download existing key
3. Save as `pumpitbetter-05d1d8b55bc8.json` in project root

### First-Time Setup Verification

**Complete verification script:**
```bash
#!/bin/bash
# verify-build-setup.sh

echo "üîç Verifying build machine setup..."

# Check required tools
echo "‚úÖ Checking development tools..."
node --version || echo "‚ùå Node.js not installed"
npm --version || echo "‚ùå npm not installed"  
rustc --version || echo "‚ùå Rust not installed"
npx tauri --version || echo "‚ùå Tauri CLI not installed"
fastlane --version || echo "‚ùå FastLane not installed"
ruby --version || echo "‚ùå Ruby not installed"

# Check required files
echo "‚úÖ Checking required files..."
[ -f .env ] && echo "‚úÖ .env exists" || echo "‚ùå .env missing"
[ -f keystore.jks ] && echo "‚úÖ keystore.jks exists ($(stat -f%z keystore.jks) bytes)" || echo "‚ùå keystore.jks missing"
[ -f pumpitbetter-05d1d8b55bc8.json ] && echo "‚úÖ Google Play JSON exists ($(stat -f%z pumpitbetter-05d1d8b55bc8.json) bytes)" || echo "‚ùå Google Play JSON missing"

# Check iOS setup
echo "‚úÖ Checking iOS setup..."
security find-identity -v -p codesigning | grep "Apple Distribution" && echo "‚úÖ Apple Distribution certificate found" || echo "‚ö†Ô∏è  Apple Distribution certificate will be auto-created"

# Check Android setup  
echo "‚úÖ Checking Android setup..."
keytool -list -keystore ./keystore.jks -alias pumpitbetter -storepass $(grep ANDROID_KEYSTORE_PASSWORD .env | cut -d'"' -f2) 2>/dev/null && echo "‚úÖ Android keystore verified" || echo "‚ùå Android keystore invalid"

echo "üöÄ Setup verification complete!"
```

**Run verification:**
```bash
chmod +x verify-build-setup.sh
./verify-build-setup.sh
```

## ÔøΩüîß Project Setup

### 1. Clone and Setup Project

```bash
# Clone the repository
git clone [repository-url]
cd pibspa

# Install dependencies (automatically installs fswatch and other dev tools on macOS)
npm install
```

**Automatic Setup:** The `npm install` command will automatically:
- ‚úÖ Install all Node.js dependencies
- ‚úÖ Install Homebrew (if missing)
- ‚úÖ Install `fswatch` for hot reloading
- ‚úÖ Install `rbenv` and Ruby for Fastlane
- ‚úÖ Install Fastlane for iOS/Android automation
- ‚úÖ Install Rust toolchain with iOS targets for Tauri
- ‚úÖ Check for remaining dependencies and provide guidance

### 2. Environment Configuration

```bash
# Copy environment template
cp .env.example .env

# Edit the .env file with your Apple Developer credentials
nano .env
```

Fill in these values in your `.env` file:

```properties
# Apple Developer credentials (DO NOT COMMIT THIS FILE)
APPLE_ID="your-apple-id@email.com"           # Your Apple Developer account email
APP_SPECIFIC_PASSWORD="your-app-password"    # Generated from appleid.apple.com
TEAM_ID="YOUR_APPLE_TEAM_ID"                 # 10-character string from developer.apple.com
BUNDLE_ID="com.pumpitbetter.app"             # App identifier (already set)
APP_NAME="Pump It Better"                    # App display name (already set)

# Android credentials (DO NOT COMMIT THIS FILE)
ANDROID_KEYSTORE_PATH="./keystore.jks"       # Path to your keystore file
ANDROID_KEYSTORE_PASSWORD="your_password"    # Password for keystore
ANDROID_KEY_ALIAS="pumpitbetter"                # Key alias (project standard)
ANDROID_KEY_PASSWORD="your_key_password"     # Password for key
PLAY_STORE_JSON_KEY_PATH="./pumpitbetter-05d1d8b55bc8.json" # Path to Play Store API key
GOOGLE_PLAY_PACKAGE_NAME="com.pumpitbetter.app"  # Package name (same as bundle ID)
```

**Variable Mapping:**
- `APPLE_ID` ‚Üí Your Apple Developer account email address
- `APP_SPECIFIC_PASSWORD` ‚Üí App-specific password for two-factor authentication  
- `TEAM_ID` ‚Üí Your Apple Developer Team ID (found in Membership Details)
- `BUNDLE_ID` ‚Üí App bundle identifier (pre-configured for this project)
- `APP_NAME` ‚Üí App display name (pre-configured for this project)
- `ANDROID_KEYSTORE_PATH` ‚Üí Path to your Android keystore file (.jks)
- `ANDROID_KEYSTORE_PASSWORD` ‚Üí Password for your Android keystore
- `ANDROID_KEY_ALIAS` ‚Üí Alias of the key in your keystore (project uses "pumpitbetter")
- `ANDROID_KEY_PASSWORD` ‚Üí Password for the specific key in keystore
- `PLAY_STORE_JSON_KEY_PATH` ‚Üí Path to Google Play Store API service account JSON key
- `GOOGLE_PLAY_PACKAGE_NAME` ‚Üí Google Play package name (same as bundle ID)

### 3. Apple Developer Credentials Setup

#### Get your Team ID:
1. Go to [developer.apple.com](https://developer.apple.com)
2. Sign in ‚Üí **Account** ‚Üí **Membership Details**
3. Copy your Team ID (10-character string like `ABCD123456`)
4. **Add to `.env` file**: `TEAM_ID="YOUR_ACTUAL_TEAM_ID"`

#### Generate App Specific Password:
1. Go to [appleid.apple.com](https://appleid.apple.com)
2. Sign in ‚Üí **Security** ‚Üí **App-Specific Passwords**
3. Click **Generate Password**
4. Label it "Fastlane PumpItBetter"
5. Copy the generated password (format: `abcd-efgh-ijkl-mnop`)
6. **Add to `.env` file**: `APP_SPECIFIC_PASSWORD="your-actual-password"`

> **Important:** App-specific passwords are required for two-factor authentication accounts. Regular Apple ID passwords will not work with FastLane.

#### Verify Apple Developer Account Access

**Test your credentials:**
```bash
# Test Apple ID login (will prompt for credentials)
fastlane spaceauth -u your-apple-id@email.com

# Should show: "Login successful"
```

#### Certificate and Profile Management

Your certificates and provisioning profiles will be automatically managed by FastLane during the first build. The automation will:

1. **Check for existing Apple Distribution certificate**
2. **Create certificate if missing** (requires admin approval)
3. **Check for App Store provisioning profile**
4. **Create profile if missing**
5. **Update Xcode project with correct signing settings**

**Manual verification (optional):**
```bash
cd fastlane

# Check certificate status
fastlane cert --readonly

# Check provisioning profile status  
fastlane sigh --readonly --app_identifier com.pumpitbetter.app
```

## ‚úÖ Verify Installation

Test that everything is working:

### 1. Frontend Development
```bash
npm run dev
```
Should start the development server at `http://localhost:5173`

### 2. Desktop App
```bash
npm run tauri:dev
```
Should open the desktop app

### 3. iOS Simulator
```bash
npm run ios:dev
```
Should build and open in iOS Simulator (will prompt you to select a simulator)

**Note:** On first run, you'll need to:
1. Select a simulator from the list (e.g., iPhone 16 = option 12)
2. Wait for the initial build (can take 3-5 minutes)
3. The iOS Simulator should open with your app

### 4. Android Emulator or Device
```bash
npm run android:dev
```
Should build and open in Android emulator or connected device

**Note:** On first run, you'll need to:
1. Have an emulator running or device connected
2. Wait for the initial build (can take 5-10 minutes)
3. The Android app should open automatically

### 5. Fastlane Automated Setup

**Test the complete iOS automated workflow:**
```bash
npm run ios:beta
```

This will:
- ‚úÖ Build React Router frontend
- ‚úÖ Compile Tauri iOS app  
- ‚úÖ Automatically handle code signing
- ‚úÖ Create .ipa file
- ‚úÖ Upload to TestFlight
- ‚úÖ **Zero manual intervention required**

**Test the complete Android automated workflow:**
```bash
npm run android:beta
```

This will:
- ‚úÖ Build React Router frontend
- ‚úÖ Compile Tauri Android app
- ‚úÖ Configure Android signing with keystore
- ‚úÖ Create signed APK and AAB files
- ‚úÖ Upload to Play Store beta track
- ‚úÖ **Zero manual intervention required**

**Expected output:**
```
[17:02:06]: Using app-specific password authentication from .env file
[17:02:07]: Login successful
[17:02:38]: Upload to TestFlight complete! üéâ
```

**On first run, FastLane may:**
- Create Apple Distribution certificate (if missing)
- Generate App Store provisioning profile (if missing)
- Prompt for admin approval for certificate creation

cd fastlane && fastlane --version
```
Should show Fastlane version without errors

## üîç Troubleshooting

### Common Issues

**"command not found: brew"**
- Restart terminal after installing Homebrew
- Make sure Homebrew is in your PATH

**"command not found: tauri"**
```bash
npm install -g @tauri-apps/cli
```

**"command not found: fswatch"**
```bash
brew install fswatch
```

**Hot reloading not working in SSR development**
- Ensure `fswatch` is installed: `fswatch --version`
- Check file watcher is running: `ps aux | grep fswatch`
- Restart SSR development: `npm run dev:ssr`
- File changes in `app/routes-ssr/` should automatically sync to `app/routes/`

**Ruby/rbenv issues**
```bash
# Check rbenv is in PATH
which rbenv

# If not found, add to shell:
echo 'export PATH="$HOME/.rbenv/bin:$PATH"' >> ~/.zshrc
echo 'eval "$(rbenv init -)"' >> ~/.zshrc
source ~/.zshrc
```

**iOS build failures**
- Ensure Xcode is installed and license accepted
- Check Apple Developer credentials in `.env`
- Make sure iOS targets are installed: `rustup target list --installed`
- Run `npx tauri ios init` to initialize iOS project
- Verify Team ID is set in `src-tauri/tauri.conf.json`

**Certificate/provisioning issues**
```bash
# Check certificate is installed
security find-identity -v -p codesigning

# Check provisioning profiles
ls ~/Library/MobileDevice/Provisioning\ Profiles/

# Regenerate if needed
cd fastlane
fastlane cert --force
fastlane sigh --force
```

**FastLane authentication errors**
- Verify App Specific Password is correct in `.env`
- Check Team ID matches your Apple Developer account  
- Test login: `fastlane spaceauth -u your-apple-id@email.com`
- Ensure bundle ID is registered in Apple Developer Portal

**"No valid signing identity found"**
- Install Xcode and accept license: `sudo xcodebuild -license accept`
- Check Apple Developer account has valid certificates
- Run certificate setup: `cd fastlane && fastlane cert`

**Tauri export errors (expected)**
- This is a known limitation with Tauri iOS export
- The workflow automatically falls back to manual .ipa creation
- Final .ipa file quality is not affected

**Android keystore issues**
- Ensure keystore exists at the path specified in `.env`
- Run `npm run android:sign` to create a new keystore
- For Play Store deployment, ensure JSON key file exists
- Double-check all credentials match in `.env` file

## ÔøΩ Web Deployment Setup (Fly.io)

### Dual Application Architecture

PumpItBetter deploys both the SSR marketing website and SPA fitness app to a single Fly.io instance:

- **üì± Fitness App**: `https://app.pumpitbetter.com` ‚Üí SPA build for user workouts
- **üåê Marketing Site**: `https://www.pumpitbetter.com` ‚Üí SSR build for marketing/SEO
- **üöÄ Single Instance**: Both apps run on the same server with subdomain routing
- **üíæ Database**: Managed PostgreSQL with separate databases for test/prod

### 1. Fly.io Authentication

```bash
# Login to Fly.io (opens browser for authentication)
flyctl auth login

# Verify login
flyctl auth whoami
```

### 2. Environment Setup

**Two Environments:**
- **Test/Staging**: `pumpitbetter-test.fly.dev` for testing deployments
- **Production**: `www.pumpitbetter.com` and `app.pumpitbetter.com` for live site

### 3. Deployment Commands

**Deploy to Test Environment:**
```bash
npm run deploy:test
```

**Deploy to Production:**
```bash
npm run deploy:prod
```

**Monitor Deployments:**
```bash
# View logs
npm run fly:logs

# Check status
npm run fly:status

# SSH into server
npm run fly:ssh
```

### 4. Database Setup (when ready)

When you're ready to add PostgreSQL:

```bash
# Create production database
flyctl postgres create --name pumpitbetter-pg --region iad

# Attach to production app
flyctl postgres attach --app pumpitbetter-prod pumpitbetter-pg

# Create separate database for test environment
flyctl postgres db create --app pumpitbetter-pg pumpitbetter_test

# Set database URLs
flyctl secrets set DATABASE_URL="postgres://..." --app pumpitbetter-prod
flyctl secrets set DATABASE_URL="postgres://..." --app pumpitbetter-test
```

### 5. Custom Domain Setup

**Configure Custom Domains:**
```bash
# Add production domains
flyctl certs create www.pumpitbetter.com --app pumpitbetter-prod
flyctl certs create app.pumpitbetter.com --app pumpitbetter-prod

# Configure DNS (set these DNS records):
# www.pumpitbetter.com CNAME pumpitbetter-prod.fly.dev
# app.pumpitbetter.com CNAME pumpitbetter-prod.fly.dev
```

### 6. Health Monitoring

```bash
# Check application health
curl https://www.pumpitbetter.com/health
curl https://app.pumpitbetter.com/health

# Monitor logs in real-time
flyctl logs --app pumpitbetter-prod
```

### 7. Environment Variables

Add secrets to Fly.io apps:
```bash
# Production secrets
flyctl secrets set NODE_ENV=production --app pumpitbetter-prod
flyctl secrets set DATABASE_URL="your-prod-db-url" --app pumpitbetter-prod

# Test secrets  
flyctl secrets set NODE_ENV=staging --app pumpitbetter-test
flyctl secrets set DATABASE_URL="your-test-db-url" --app pumpitbetter-test
```

### 8. Troubleshooting Web Deployment

**Common Issues:**

**"flyctl not found"**
```bash
brew install flyctl
```

**"Authentication failed"**
```bash
flyctl auth login
```

**"Deploy failed"**
- Check logs: `flyctl logs --app pumpitbetter-test`
- Verify build: `npm run build:all`
- Check Dockerfile syntax

**"Health check failed"**
- Test locally: `npm run build:deploy && node scripts/combined-server.js`
- Verify port 8080 is accessible
- Check server logs for errors

## ÔøΩüéØ Next Steps

After completing setup:

1. **Read BUILD.md** - Learn about build processes and deployment
2. **Run tests** - `npm test` to verify everything works
3. **Try web deployment** - Deploy to test: `npm run deploy:test`
4. **Make a test build** - Try `npm run ios:build` to test iOS pipeline
5. **Join development** - You're ready to contribute!

## üìö Additional Resources

- [Tauri Documentation](https://tauri.app/v2/guides/)
- [React Router Documentation](https://reactrouter.com/)
- [Fastlane Documentation](https://docs.fastlane.tools/)
- [Apple Developer Documentation](https://developer.apple.com/documentation/)
- [Rust Documentation](https://doc.rust-lang.org/)

## üÜò Getting Help

If you encounter issues:

1. Check this setup guide again
2. Look at error messages carefully
3. Search existing GitHub issues
4. Ask the team in Slack/Discord
5. Create a new issue with full error details

---

**Last Updated:** August 2025  
**Target Platform:** macOS only  
**Estimated Setup Time:** 30-60 minutes (depending on download speeds)  
**Ruby Version:** 3.4.5+ (via rbenv)  
**FastLane:** 2.x with automatic .env loading  
**iOS Automation:** Fully automated TestFlight deployment  
**Android Automation:** Fully automated Play Store beta deployment
